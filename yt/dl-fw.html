<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/res/css/shared.css">
	<link rel="stylesheet" href="/res/css/table.css">
	<link rel="stylesheet" href="/res/css/details-triangle.css">
	<link rel="stylesheet" href="/res/css/yt/dl.css">
</head>

<body class="tt-vert">
	<h1 id="title"><a class="tt-home" href="/">trustytrojan.dev</a>/yt/dl-fw</h1>

	<div class="tt-text">
		this is <a href="/yt/dl">yt/dl</a> using <a href="https://ffmpegwasm.netlify.app/">ffmpeg.wasm</a> for adding metadata and muxing,<br>
		and <a href="https://github.com/trustytrojan/ytdl-core">my dependency-free version of ytdl-core</a> for getting video info.<br>
		this eliminates the need for a backend!
	</div>

	<input type="text" id="yt-id-or-url" class="tt-clickable" placeholder="youtube video id/link"
		onkeypress="if (event.key === 'Enter') getInfo()">
	
	<div id="loading" class="tt-subtle" hidden>loading...</div>

	<div id="everything-else" class="tt-vert">
		<a id="details-root" class="tt-clickable" target="_blank">
			<img id="details-thumbnail">
			<div id="details-text">
				<b id="details-title"></b>
				<div id="details-channel"></div>
				<div id="details-views-length"></div>
			</div>
		</a>

		<div id="ffmpeg-output" class="tt-text" style="color:gray" hidden></div>

		<button id="hq-btn" class="tt-clickable">download!</button>

		<details id="hq-btns" class="tt-text">
			<summary>
				<div class="tt-subtle">a/v only</div>
			</summary>

			<div class="tt-vert">
				<button id="hqv-btn" class="tt-clickable">download video only</button>
				<button id="hqa-btn" class="tt-clickable">download audio only</button>
			</div>
		</details>

		<div id="help-text" class="tt-text">
			use the links above for the highest quality audio/video!<br>
			videos are provided in matroska (.mkv) format, and audio in mpeg-3 (.mp3).<br>
			you can also mix and match audio/video qualities below.
		</div>

		<details class="tt-text">
			<summary>
				<div class="tt-subtle">customize</div>
			</summary>

			<div class="tt-vert">
				<div id="help-text" class="tt-text">
					left-click formats to select for download.<br>
					right-click to copy links to streams from youtube.
				</div>

				<button id="dl-button" class="tt-clickable" href>download!</button>
			</div>

			<div class="tt-horiz" style="align-items: flex-start">
				<div id="copied-popup" hidden>copied link!</div>

				<div class="tt-vert">
					<h2 class="tt-subtle">video</h2>
					<div class="tt-border table-wrapper">
						<table>
							<thead>
								<tr>
									<th>itag</th>
									<th>quality</th>
									<th>codec</th>
									<th>bitrate</th>
								</tr>
							</thead>
							<tbody id="video-tb"></tbody>
						</table>
					</div>
				</div>

				<div class="tt-vert">
					<h2 class="tt-subtle">audio</h2>
					<div class="tt-border table-wrapper">
						<table>
							<thead>
								<tr>
									<th>itag</th>
									<th>quality</th>
									<th>codec</th>
									<th>bitrate</th>
								</tr>
							</thead>
							<tbody id="audio-tb"></tbody>
						</table>
					</div>

					<h2 class="tt-subtle">both</h2>
					<div class="tt-border table-wrapper">
						<table>
							<thead>
								<tr>
									<th>itag</th>
									<th>quality</th>
									<th>codecs</th>
									<th>bitrate</th>
								</tr>
							</thead>
							<tbody id="av-tb"></tbody>
						</table>
					</div>
				</div>
			</div>
		</details>
	</div>

	<script type="module">
		import { getInfo } from '/res/js/yt/dl-fw.js';
		import { ytIdOrUrl } from '/res/js/yt/dl-fw-elements.js';
		window.getInfo = getInfo;

		const params = new URLSearchParams(window.location.search);
		const v = params.get('v');
		if (v) {
			ytIdOrUrl.value = v;
			getInfo();
		}

		import { setBaseUrl } from '/res/js/ytdl-core/lib/proxy.js';
		setBaseUrl('https://proxy.trustytrojan.dev/?uri=');
	</script>
</body>

</html>